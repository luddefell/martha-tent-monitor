<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mushroom Tent Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f9f9f9;
      --fg: #333;
      --card-bg: #fff;
      --primary: #36a2eb;
      --accent: #ff6384;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #121212;
        --fg: #eee;
        --card-bg: #1e1e1e;
      }
    }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: 'Inter', sans-serif;
      text-align: center;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      margin-bottom: 0.2em;
    }
    #lastUpdate {
      font-size: 0.9rem;
      color: var(--fg);
      margin-top: 0;
      margin-bottom: 1.5rem;
    }
    #container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      max-width: 800px;
      margin: 0 auto 2rem;
    }
    .card {
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1rem;
    }
    .card h2 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--primary);
    }
    .card p {
      margin: 0.5rem 0 0;
      color: var(--accent);
      font-weight: 600;
    }
    canvas {
      max-width: 800px;
      margin: 0 auto;
      display: block;
    }
  </style>
</head>
<body>
  <h1>Mushroom Tent</h1>
  <p id="lastUpdate">Last update: --:--:--</p>
  <div id="container">
    <div class="card">
      <h2 id="temp">--°F</h2><p>Temperature</p>
    </div>
    <div class="card">
      <h2 id="hum">--%</h2><p>Humidity</p>
    </div>
    <div class="card">
      <h2 id="co2">-- ppm</h2><p>CO₂</p>
    </div>
  </div>
  <canvas id="trendChart" height="200"></canvas>
  <script>
    // Replace with your ThingSpeak channel ID and read API key
    const CH_ID = 'YOUR_CHANNEL_ID';
    const READ_KEY = 'YOUR_READ_API_KEY';

    async function fetchData() {
      const url = `https://api.thingspeak.com/channels/${CH_ID}/feeds.json?api_key=${READ_KEY}&results=1`;
      try {
        const res = await fetch(url);
        const json = await res.json();
        const f = json.feeds[0];
        document.getElementById('temp').textContent = `${(+f.field1).toFixed(1)}°F`;
        document.getElementById('hum').textContent  = `${(+f.field2).toFixed(0)}%`;
        document.getElementById('co2').textContent  = `${f.field3} ppm`;
        document.getElementById('lastUpdate').textContent =
          `Last update: ${new Date().toLocaleTimeString()}`;
      } catch (e) {
        console.error('Fetch error:', e);
      }
    }

    let chart;
    async function setupChart() {
      const ctx = document.getElementById('trendChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            { label: 'CO₂ (ppm)', data: [], borderColor: 'var(--accent)', fill: false },
            { label: 'Temp (°F)', data: [], borderColor: 'var(--primary)', fill: false },
            { label: 'Hum (%)', data: [], borderColor: '#4bc0c0', fill: false },
          ]
        },
        options: {
          scales: { x: { display: false } },
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }

    async function fetchTrend() {
      const url = `https://api.thingspeak.com/channels/${CH_ID}/feeds.json?api_key=${READ_KEY}&results=50`;
      try {
        const res = await fetch(url);
        const json = await res.json();
        const times = json.feeds.map(f => f.created_at.substr(11, 5));
        chart.data.labels = times;
        chart.data.datasets[0].data = json.feeds.map(f => +f.field3);
        chart.data.datasets[1].data = json.feeds.map(f => +f.field1);
        chart.data.datasets[2].data = json.feeds.map(f => +f.field2);
        chart.update();
      } catch (e) {
        console.error('Trend fetch error:', e);
      }
    }

    window.onload = async () => {
      await setupChart();
      fetchData();
      fetchTrend();
      setInterval(() => { fetchData(); fetchTrend(); }, 20000);
    };
  </script>
</body>
</html>

